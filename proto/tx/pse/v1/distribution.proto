syntax = "proto3";
package tx.pse.v1;

import "gogoproto/gogo.proto";
import "cosmos_proto/cosmos.proto";

option go_package = "github.com/tokenize-x/tx-chain/v6/x/pse/types";

// SubAccountMapping defines the mapping between a module account and its sub account (multisig wallet).
// This mapping can be modified via governance proposals.
message SubAccountMapping {
  // module_account is the name of the module account holding the tokens to be distributed.
  string module_account = 1 [
    (gogoproto.moretags) = "yaml:\"module_account\""
  ];

  // sub_account_address is the multisig wallet address that will receive the token distributions.
  string sub_account_address = 2 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.moretags) = "yaml:\"sub_account_address\""
  ];
}

// ModuleDistribution defines the amount to be distributed from a specific module account.
message ModuleDistribution {
  // module_account is the name of the module account.
  string module_account = 1 [
    (gogoproto.moretags) = "yaml:\"module_account\""
  ];

  // amount is the number of tokens to distribute from this module account.
  // This amount is for the distribution denom (see DistributionDenom constant).
  string amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"amount\""
  ];
}

// DistributionPeriod defines a single distribution event at a specific timestamp.
// Multiple module accounts can distribute tokens at the same time.
message DistributionPeriod {
  // distribution_time is when this distribution should occur (Unix timestamp in seconds).
  uint64 distribution_time = 1 [
    (gogoproto.moretags) = "yaml:\"distribution_time\""
  ];

  // distributions is the list of amounts to distribute from each module account at this time.
  repeated ModuleDistribution distributions = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"distributions\""
  ];
}

// CompletedDistribution tracks a distribution that has been executed.
// These are immutable historical records.
message CompletedDistribution {
  // module_account is the name of the module account that distributed the tokens.
  string module_account = 1 [
    (gogoproto.moretags) = "yaml:\"module_account\""
  ];

  // sub_account is the multisig wallet address that received the distribution.
  string sub_account = 2 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (gogoproto.moretags) = "yaml:\"sub_account\""
  ];

  // scheduled_time was the originally scheduled distribution time (Unix timestamp in seconds).
  uint64 scheduled_time = 3 [
    (gogoproto.moretags) = "yaml:\"scheduled_time\""
  ];

  // actual_distribution_time is when the distribution actually occurred (Unix timestamp in seconds).
  uint64 actual_distribution_time = 4 [
    (gogoproto.moretags) = "yaml:\"actual_distribution_time\""
  ];

  // amount is the number of tokens that were distributed.
  string amount = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"amount\""
  ];

  // block_height is the block height at which the distribution occurred.
  int64 block_height = 6 [
    (gogoproto.moretags) = "yaml:\"block_height\""
  ];
}

// PendingDistributionInfo provides detailed information about a scheduled pending distribution.
// used for query purposes to get the details of a pending distribution.
message PendingDistributionInfo {
  // distribution_time is when this distribution is scheduled to occur (Unix timestamp in seconds).
  uint64 distribution_time = 1 [
    (gogoproto.moretags) = "yaml:\"distribution_time\""
  ];

  // remaining_seconds is the time remaining until the distribution occurs (in seconds).
  // This is calculated as distribution_time - current_block_time.
  // Will be 0 if the distribution is overdue (shouldn't happen in normal operation).
  int64 remaining_seconds = 2 [
    (gogoproto.moretags) = "yaml:\"remaining_seconds\""
  ];

  // distributions is the list of amounts that will be distributed from each module account at this time.
  repeated ModuleDistribution distributions = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"distributions\""
  ];

  // total_amount is the sum of all distribution amounts across all module accounts for this period.
  string total_amount = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (gogoproto.moretags) = "yaml:\"total_amount\""
  ];
}
